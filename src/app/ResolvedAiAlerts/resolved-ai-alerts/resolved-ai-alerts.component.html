<div class="page-container">
  <h2>Resolved AI Alerts</h2>
  <p><strong>Total AI-Resolved Alerts:</strong> {{ alertCount }}</p>
  <p><strong>Average Satisfaction Score:</strong> {{ averageSatisfaction | number:'1.1-1' }}</p>

  <!-- Date Range Filter and Export -->
  <div class="filter-container">
    <div class="form-group">
      <label for="startDate">Start Date :</label>
      <input id="startDate" type="date" [formControl]="startDate" required>
    </div>
    <div class="form-group">
      <label for="endDate">End Date :</label>
      <input id="endDate" type="date" [formControl]="endDate" required>
    </div>
    <button nbButton status="primary" (click)="filterByDateRange()">Filter</button>
    <button nbButton status="warning" (click)="resetDateFilter()">Reset</button>
    <button nbButton status="success" (click)="exportToCSV()">Export to CSV</button>
  </div>

  <!-- Loader -->
  <div *ngIf="isLoading" class="loader-container">
    <div class="spinner"></div>
  </div>

  <!-- Table -->
  <div *ngIf="resolvedAiAlerts.length > 0 && !isLoading">
    <table mat-table [dataSource]="resolvedAiAlerts" class="mat-elevation-z8">
      <ng-container matColumnDef="capteur">
        <th mat-header-cell *matHeaderCellDef>Valeur Déclenchement</th>
        <td mat-cell *matCellDef="let alert">{{ alert.valeurDeclenchement || 'N/A' }}</td>
      </ng-container>
      <ng-container matColumnDef="typePanne">
        <th mat-header-cell *matHeaderCellDef>Type de Panne</th>
        <td mat-cell *matCellDef="let alert">{{ alert.typePanne }}</td>
      </ng-container>
      <ng-container matColumnDef="gravite">
        <th mat-header-cell *matHeaderCellDef>Gravité</th>
        <td mat-cell *matCellDef="let alert">{{ alert.niveauGravite }}</td>
      </ng-container>
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let alert">{{ formatDate(alert.dateAlerte) }}</td>
      </ng-container>
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let alert">{{ alert.description }}</td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let alert">
          <button mat-raised-button color="primary" (click)="viewInterventionDetails(alert)">View Intervention</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <div *ngIf="resolvedAiAlerts.length === 0 && !isLoading">
    <p>No AI-resolved alerts found.</p>
  </div>
</div>